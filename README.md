# troll-engine
Troll is a bitmap-graphics game engine that supports scripting through Dart or Python.


## How to build

You can build the engine in different setups: 
* the game engine as a static library
* the game engine with [Dart](https://dartlang.org/) scripting support (and samples)
* the game engine with [Python](https://www.python.org/) scripting support (and samples)


### Dependencies
* [protobuf](https://developers.google.com/protocol-buffers/)
* [sdl2](https://www.libsdl.org/download-2.0.php), sdl2-image, sdl2-ttf, sdl2-mixer
* [glog](https://github.com/google/glog)
* [catch2](https://github.com/catchorg/Catch2)
* [abseil](https://github.com/abseil/abseil-cpp)
* [range-v3](https://github.com/ericniebler/range-v3)
* [dart_sdk](https://dartlang.org/) _(optional)_
* [python](https://www.python.org/) & [pybind11](https://github.com/pybind/pybind11) _(optional)_


### Generate Protobufs

Protocol buffers are used in troll-engine internally and for scripting. Protobuf needs to generate implementation files for every language used.

#### C++
For C++ the cmake file generates the necessary files automatically, so nothing needs to be done manually. However, if needed protobuf C++ files can be generated by running `protoc --cpp_out=. @protos` inside the `troll/protos/` path.

#### Dart
If using Dart as the scripting language when proto files are updated dart files need to be generated by running `protoc --plugin=protoc-gen-dart=<USER_PATH>\AppData\Roaming\Pub\Cache\bin\protoc-gen-dart.bat --dart_out=../dart_troll/lib/src/proto @protos` inside the `troll/protos/` path.

#### Python
If using Python as the scripting language when proto files are updated dart files need to be generated by running `protoc --python_out=. @protos` inside the `troll/protos/` path.


### Build with CMake
For building a release version of the engine use:
```bash
cmake .. -DBUILD_TESTING=OFF -DCMAKE_BUILD_TYPE=Release
cmake --build .
```

The `-DBUILD_TESTING=OFF` is necessary for disabling abseil tests that use gtest and bring unnecessary dependencies. The flag is ignored for troll tests that use [Catch2](https://github.com/catchorg/Catch2) instead.

If using [vcpkg](https://github.com/Microsoft/vcpkg) as your packet mamanger add the toolchain in the cmake command:
`-DCMAKE_TOOLCHAIN_FILE="<vcpkg-root>\scripts\buildsystems\vcpkg.cmake"`

#### Dart
The troll-engine generates a dynamic library that is loaded as a [dart native extension](https://www.dartlang.org/articles/server/native-extensions).

The game engine's entry point is in dart which uses dart_troll extension to setup the game. See example in [dart_dk](samples/dart_dk).

In order to enable Dart support add `-DDART_TROLL` in the cmake command and make sure you are building 64-bit architecture. Dart SDK will fail to link if linked with a 32bit dynamic library.

Example for building troll-engine with Dart support:
```bash
cmake .. -GNinja -DBUILD_TESTING=OFF -DDART_TROLL -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake
```

#### Python
Unlike Dart support for Python troll-engine embeds the python interpreter using pybind11 library. Thus, the game engine's entry point is in C++ code and loads up the python game scripts providing also bindings to the native code. See example in [donkey_kong](samples/donkey_kong).

In order to enable Python support add `-DPYTROLL` in the cmake command.

Example for building troll-engine with Python support:
```bash
cmake .. -GNinja -DBUILD_TESTING=OFF -DPYTROLL -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake
```
